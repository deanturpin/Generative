<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="refresh" content="20">
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>

	<body>
		<canvas id="myCanvas" width="800" height="800"></canvas>

		<script>
			var canvas = document.getElementById("myCanvas")
			var context = canvas.getContext("2d")

			// Radians in a circle
			const radians = 2 * Math.PI / 360

			// A node
			function node(x, y, d, l, w, a) {

				// Start and end coordinates
				this.x1 = x
				this.y1 = y

				// End points are defaulted until node is grown
				this.x2 = 0
				this.y2 = 0

				// Direction, width and length of growth
				this.direction = d
				this.length = l
				this.width = w

				// Angle of subsequent branches
				this.angle = a

				// Grow this node
				this.grow = function() {

					// Trig
					this.x2 = this.x1 + (this.length * Math.cos(this.direction * radians))
					this.y2 = this.y1 + (this.length * Math.sin(this.direction * radians))

					// Scale the tree
					const scale = 18
					const xOffset = 100
					const yOffset = 50

					// Render current branch
					context.beginPath()
					context.moveTo(xOffset + scale * this.x1, yOffset - scale * this.y1)
					context.lineTo(xOffset + scale * this.x2, yOffset - scale * this.y2)
					context.lineWidth = this.width
					context.strokeStyle = "cyan"
					context.stroke()
				}

				// Branch this node
				this.branch = function(sway) {

					// Direction is old direction plus a sway
					const direction = this.direction + (this.angle * sway)

					// Return new node
					var n = new node(
					
						// New start coordinates
						this.x2, this.y2,

						// Direction of growth
						direction,

						// Length
						this.length * 1.1 + Math.random() * .4,

						// Line width
						this.width * .8,

						// Angle of subsequent branch
						this.angle * .7)

					// And grow it
					n.grow()

					return n
				}
			}

			// Draw a tree
			function draw() {

				// Create first node at the origin pointing upwards
				nodes = []
				nodes[nodes.length] = new node(

					// Start coordinates
					0, 0,

					// Direction of growth
					0,

					// Length
					1.5,

					// Line width
					1,

					// Angle of subsequent branch
					80
				)

				// Grow the first node
				nodes[0].grow()

				firstNode = 0

				// Branch for a few iterations
				for (i = 0; i < 20; ++i) {

					// Store final node before adding more
					totalNodes = nodes.length

					// Iterate over nodes adding new branches
					for (n = firstNode; n < totalNodes; ++n) {

						// Branch node
						nodes[nodes.length] = nodes[n].branch(1 + .6 * Math.random())
					}

					// On the next iteration only branch the new nodes
					firstNode = totalNodes
				}
			}

			// Periodically draw the tree
			setInterval(function() { draw() }, 10) 
		</script>
	</body>
</html>
